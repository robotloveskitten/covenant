<div data-controller="combobox"
     data-combobox-url-value="<%= users_search_path %>"
     data-combobox-placeholder-value="Unassigned"
     class="relative flex flex-nowrap">

  <!-- Hidden input for form submission -->
  <input type="hidden"
         name="task[assignee_id]"
         value="<%= task.assignee_id %>"
         data-combobox-target="hiddenInput">

  <!-- Selected value display / trigger -->
  <button type="button"
          data-action="click->combobox#toggle"
          class="flex items-center gap-2 px-1 py-1 rounded hover:bg-base-200 transition-colors min-w-[120px]">
    <div data-combobox-target="selected" class="flex items-center gap-2 flex-nowrap">
      <% if has_assignee? %>
        <div class="flex items-center gap-2 flex-nowrap">
          <div class="w-6 h-6 shrink-0 rounded-full bg-base-300 flex items-center justify-center text-xs font-medium">
            <%= assignee_initial %>
          </div>
          <span class="text-sm truncate"><%= task.assignee.display_name %></span>
          <div type="button" data-action="click->combobox#clear" class="w-4 h-4 shrink-0 text-base-content/40 hover:text-base-content">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      <% else %>
        <span class="text-sm text-base-content/40">Unassigned</span>
      <% end %>
    </div>
  </button>

  <!-- Dropdown -->
  <div data-combobox-target="dropdown"
       class="hidden absolute top-full left-0 mt-1 w-64 bg-base-100 border border-base-200 rounded-lg shadow-lg z-50">
    <!-- Search input -->
    <div class="p-2 border-b border-base-200">
      <input type="text"
             data-combobox-target="input"
             data-action="input->combobox#search keydown->combobox#onKeydown"
             placeholder="Search users..."
             class="input input-sm input-bordered w-full">
    </div>

    <!-- Results list -->
    <div data-combobox-target="list" class="max-h-48 overflow-y-auto">
      <div class="px-3 py-2 text-sm text-base-content/50">Type to search...</div>
    </div>
  </div>
</div>
