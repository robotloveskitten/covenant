<div data-controller="kanban" data-kanban-task-id-value="<%= task.id %>">
  <div class="flex items-center justify-between mb-6">
    <h3 class="text-lg font-medium text-base-content">Kanban Board</h3>
    <% if user_signed_in? && task.allowed_child_types.any? %>
      <%= link_to new_task_path(parent_id: task.id, task_type: task.allowed_child_types.first), class: "btn btn-sm btn-ghost" do %>
        + Add Item
      <% end %>
    <% end %>
  </div>

  <div class="flex gap-4 overflow-x-auto pb-4">
    <% Task::STATUSES.each do |status| %>
      <div class="kanban-column flex-shrink-0 w-72 bg-base-200/30 rounded-lg p-3"
           data-kanban-target="column"
           data-status="<%= status %>">
        <div class="flex items-center justify-between mb-3">
        
          <h4 class="text-sm font-medium text-base-content/70"><%= Task::STATUS_LABELS[status] %></h4>
          <span class="text-xs text-base-content/40"><%= children.by_status(status).count %></span>
        </div>
        
        <div class="space-y-2 min-h-[100px]" 
             data-kanban-target="list"
             data-status="<%= status %>">
          <% children.by_status(status).ordered.each do |child| %>
            <%= render partial: 'kanban_card', locals: { task: child } %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
