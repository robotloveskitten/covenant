<div class="min-h-screen" data-controller="view-toggle">
  <!-- Header -->
  <header class="border-b border-base-200 bg-base-100 sticky top-0 z-10">
    <div class="max-w-6xl mx-auto px-6 py-3">
      <!-- Breadcrumb -->
      <%= render BreadcrumbComponent.new(task: @task) %>
      
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <%= render TypeBadgeComponent.new(task_type: @task.task_type, soft: true) %>
          <h1 class="text-2xl font-semibold text-base-content"><%= @task.title %></h1>
        </div>
        
        <div class="flex items-center gap-2">
          <!-- View toggle -->
          <div class="join">
            <button class="join-item btn btn-sm" 
                    data-view-toggle-target="documentBtn"
                    data-action="click->view-toggle#showDocument"
                    data-active-class="btn-active">
              Document
            </button>
            <button class="join-item btn btn-sm"
                    data-view-toggle-target="kanbanBtn"
                    data-action="click->view-toggle#showKanban">
              Kanban
            </button>
          </div>
          
          <% if user_signed_in? %>
            <%= link_to edit_task_path(@task), class: "btn btn-sm btn-ghost" do %>
              Edit
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </header>

  <!-- Document View -->
  <div data-view-toggle-target="documentView">
    <main class="max-w-6xl mx-auto px-6 py-6">
      <div class="flex gap-8">
        <!-- Main content area (2/3) -->
        <div class="flex-1 min-w-0">
          <!-- Task metadata -->
          <%= render TaskMetadataComponent.new(task: @task, editable: user_signed_in?) %>

          <!-- Content -->
          <%= render TiptapEditorComponent.new(task: @task, editable: user_signed_in?) %>

          <!-- Children list -->
          <% if @children.any? %>
            <div class="mt-8 pt-8 border-t border-base-200">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-medium text-base-content/70">Sub-items</h3>
                <% if user_signed_in? && @task.allowed_child_types.any? %>
                  <%= link_to new_task_path(parent_id: @task.id, task_type: @task.allowed_child_types.first), class: "btn btn-xs btn-ghost" do %>
                    + Add
                  <% end %>
                <% end %>
              </div>
              <div class="space-y-1">
                <% @children.each do |child| %>
                  <%= render TaskListItemComponent.new(task: child) %>
                <% end %>
              </div>
            </div>
          <% elsif user_signed_in? && @task.allowed_child_types.any? %>
            <div class="mt-8 pt-8 border-t border-base-200">
              <%= link_to new_task_path(parent_id: @task.id, task_type: @task.allowed_child_types.first), class: "text-sm text-base-content/40 hover:text-base-content" do %>
                + Add sub-item
              <% end %>
            </div>
          <% end %>
        </div>

        <!-- Sidebar (1/3) -->
        <%= render SidebarComponent.new(task: @task) %>
      </div>
    </main>
  </div>

  <!-- Kanban View -->
  <div data-view-toggle-target="kanbanView" class="hidden">
    <main class="max-w-6xl mx-auto px-6 py-6">
      <%= render KanbanBoardComponent.new(task: @task, children: @children) %>
    </main>
  </div>
</div>
